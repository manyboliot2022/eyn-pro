
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <title>EYN POS Pro</title>
    
    <meta name="theme-color" content="#eab308">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="EYN PRO">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/3050/3050212.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            overscroll-behavior-y: contain;
        }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        input, select, textarea { font-size: 16px !important; }
        header { padding-top: max(0.75rem, env(safe-area-inset-top)); }
        .animate-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>

    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "lucide-react": "https://esm.sh/lucide-react@0.460.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body class="overflow-hidden">
    <div id="root" class="h-screen w-screen flex flex-col"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import ReactDOM from 'react-dom/client';
        import { 
            Calculator, Package, ShoppingCart, BarChart3, Plus, Trash2, 
            ArrowRight, Search, ShoppingBag, Receipt, X, Share2, 
            MessageCircle, MapPin, Smartphone, User, Bell, DollarSign, 
            TrendingUp, TrendingDown, Save, ShieldCheck, Edit2, Barcode 
        } from 'lucide-react';

        // --- TYPES & CONSTANTS ---
        const DEFAULT_BRAND_INFO = {
            name: "Everything You Need",
            tagline: "QualitÃ© & BeautÃ© Ã  votre portÃ©e",
            phoneGn: "+224 625 24 53 50",
            phoneSn: "+221 77 588 99 48",
            whatsapp: "224625245350",
            socials: "Everytinguned",
            mapAddress: "Conakry, GuinÃ©e",
            logoUrl: "https://cdn-icons-png.flaticon.com/512/3050/3050212.png"
        };

        const PRE_DETECTED_PRODUCTS = [
            { name: 'Vaseline Intensive Care', category: 'CrÃ¨mes' },
            { name: 'Vaseline Healing Jelly', category: 'CrÃ¨mes' },
            { name: 'Vaseline Aloe Vera', category: 'CrÃ¨mes' },
            { name: 'Nivea Cream', category: 'CrÃ¨mes' },
            { name: 'Nivea Soft', category: 'CrÃ¨mes' },
            { name: 'Cerave Lotion', category: 'CrÃ¨mes' },
            { name: 'Ponds Gold Radiance', category: 'SÃ©rums' },
            { name: 'Ponds Cold Cream', category: 'Nettoyants' },
            { name: 'Jergens Original', category: 'CrÃ¨mes' },
            { name: 'Savon Noir Dudu Osun', category: 'Nettoyants' },
            { name: 'Huile d\'Argan Pure', category: 'Cheveux' },
            { name: 'SÃ©rum Vitamine C', category: 'SÃ©rums' }
        ];

        // --- COMPONENTS ---

        const CostCalculator = ({ onSync }) => {
            const [activeTab, setActiveTab] = useState('NEW');
            const [items, setItems] = useState([]);
            const [gpTotal, setGpTotal] = useState(50000);
            const [monthlyCharges, setMonthlyCharges] = useState(200000);
            const [estVolume, setEstVolume] = useState(1000);

            const totalBuyPrice = items.reduce((sum, i) => sum + (i.buyPrice * i.quantity), 0);
            const totalArticles = items.reduce((sum, i) => sum + i.quantity, 0);
            const gpPerArt = totalArticles > 0 ? gpTotal / totalArticles : 0;
            const chPerArt = estVolume > 0 ? monthlyCharges / estVolume : 0;

            const addItem = () => setItems([...items, { id: Date.now(), name: '', buyPrice: 0, quantity: 1 }]);
            const updateItem = (id, f, v) => setItems(items.map(i => i.id === id ? { ...i, [f]: v } : i));
            const deleteItem = (id) => setItems(items.filter(i => i.id !== id));

            const saveToCatalog = () => {
                if (items.length === 0) return;
                const products = JSON.parse(localStorage.getItem('eyn_products') || '[]');
                items.forEach(item => {
                    const cost = item.buyPrice + gpPerArt + chPerArt;
                    products.push({
                        id: Math.random().toString(36).substr(2, 9),
                        name: item.name || 'Nouveau Produit',
                        category: 'CosmÃ©tique',
                        barcode: '',
                        costPrice: cost,
                        sellPrice: Math.round(cost * 1.3),
                        stock: item.quantity
                    });
                });
                localStorage.setItem('eyn_products', JSON.stringify(products));
                alert("ðŸš€ Stock envoyÃ© au Manager !");
                setItems([]);
            };

            return (
                <div className="space-y-4 animate-in">
                    <div className="flex bg-slate-200 p-1 rounded-2xl gap-1">
                        <button onClick={() => setActiveTab('NEW')} className={`flex-1 py-3 text-[10px] font-black uppercase rounded-xl ${activeTab === 'NEW' ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}>ðŸ“‹ Commande</button>
                        <button onClick={() => setActiveTab('ANALYSIS')} className={`flex-1 py-3 text-[10px] font-black uppercase rounded-xl ${activeTab === 'ANALYSIS' ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}>ðŸ“Š Analyse</button>
                    </div>

                    {activeTab === 'NEW' ? (
                        <div className="space-y-4">
                            <div className="bg-slate-900 text-white rounded-3xl p-5 flex justify-between items-center shadow-lg">
                                <div className="text-center">
                                    <p className="text-[8px] font-black uppercase opacity-40">Sous-Total</p>
                                    <p className="text-sm font-black">{totalBuyPrice.toLocaleString()} FG</p>
                                </div>
                                <div className="text-center">
                                    <p className="text-[8px] font-black uppercase opacity-40">Articles</p>
                                    <p className="text-sm font-black text-yellow-500">{totalArticles}</p>
                                </div>
                                <div className="text-center">
                                    <p className="text-[8px] font-black uppercase opacity-40">CoÃ»t Final</p>
                                    <p className="text-sm font-black">{(totalBuyPrice + gpTotal).toLocaleString()} FG</p>
                                </div>
                            </div>
                            <section className="bg-white rounded-[2rem] p-6 shadow-sm border">
                                <div className="flex justify-between items-center mb-6">
                                    <h3 className="font-black text-slate-900 text-xs uppercase flex items-center gap-2"><Plus className="w-4 h-4 text-yellow-500" /> Articles</h3>
                                    <button onClick={addItem} className="bg-slate-900 text-white p-2 rounded-xl active:scale-90"><Plus className="w-4 h-4" /></button>
                                </div>
                                <div className="space-y-4">
                                    {items.map(item => (
                                        <div key={item.id} className="p-4 bg-slate-50 rounded-2xl relative border">
                                            <button onClick={() => deleteItem(item.id)} className="absolute -top-2 -right-2 bg-white text-red-500 p-1.5 rounded-full shadow border"><Trash2 className="w-3.5 h-3.5" /></button>
                                            <input type="text" placeholder="Nom produit" className="w-full bg-transparent border-b py-1 text-sm font-black mb-3 focus:outline-none" value={item.name} onChange={e => updateItem(item.id, 'name', e.target.value)} />
                                            <div className="grid grid-cols-2 gap-4">
                                                <div className="bg-white p-2 rounded-xl"><label className="text-[8px] font-black text-slate-400 uppercase">Prix Achat</label>
                                                <input type="number" className="w-full text-xs font-bold" value={item.buyPrice || ''} onChange={e => updateItem(item.id, 'buyPrice', parseFloat(e.target.value))} /></div>
                                                <div className="bg-white p-2 rounded-xl"><label className="text-[8px] font-black text-slate-400 uppercase">QtÃ©</label>
                                                <input type="number" className="w-full text-xs font-bold" value={item.quantity || ''} onChange={e => updateItem(item.id, 'quantity', parseInt(e.target.value))} /></div>
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            </section>
                            <button onClick={saveToCatalog} className="w-full bg-yellow-500 text-slate-900 font-black py-5 rounded-3xl flex items-center justify-center gap-3 shadow-xl active:scale-95 uppercase text-xs">
                                <ArrowRight className="w-5 h-5" /> Envoyer vers Stock & Manager
                            </button>
                        </div>
                    ) : (
                        <div className="space-y-4">
                            {items.length === 0 ? <p className="text-center py-10 text-slate-400 font-bold uppercase text-[10px]">Aucun article Ã  analyser</p> : items.map(item => {
                                const unitCost = item.buyPrice + gpPerArt + chPerArt;
                                return (
                                    <div key={item.id} className="bg-white rounded-[2rem] shadow-sm border overflow-hidden">
                                        <div className="bg-slate-900 p-4 flex justify-between items-center text-white">
                                            <h4 className="font-black text-sm uppercase">{item.name || 'Produit'}</h4>
                                            <p className="text-lg font-black text-yellow-500">{unitCost.toLocaleString()} FG</p>
                                        </div>
                                        <div className="p-4 space-y-2">
                                            {[{m:0.3, l:'RecommandÃ© (30%)', c:'bg-green-50 text-green-700'}, {m:0.5, l:'Bon Profit (50%)', c:'bg-blue-50 text-blue-700'}, {m:1.0, l:'Double (100%)', c:'bg-purple-50 text-purple-700'}].map(opt => (
                                                <div key={opt.m} className={`flex justify-between items-center p-3 rounded-xl ${opt.c}`}>
                                                    <span className="text-[10px] font-black uppercase">{opt.l}</span>
                                                    <span className="text-sm font-black">{Math.round(unitCost * (1+opt.m)).toLocaleString()} FG</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        };

        const ProductManager = () => {
            const [products, setProducts] = useState([]);
            const [search, setSearch] = useState('');
            const [activeTab, setActiveTab] = useState('STOCK');

            useEffect(() => {
                setProducts(JSON.parse(localStorage.getItem('eyn_products') || '[]'));
            }, []);

            const deleteP = (id) => {
                const up = products.filter(p => p.id !== id);
                setProducts(up);
                localStorage.setItem('eyn_products', JSON.stringify(up));
            };

            const importPre = () => {
                const news = PRE_DETECTED_PRODUCTS.map(p => ({
                    id: Math.random().toString(36).substr(2, 9),
                    name: p.name, category: p.category, barcode: '', costPrice: 0, sellPrice: 0, stock: 0
                }));
                const up = [...products, ...news];
                setProducts(up);
                localStorage.setItem('eyn_products', JSON.stringify(up));
                alert("ðŸ“¦ 40+ Produits importÃ©s !");
                setActiveTab('STOCK');
            };

            return (
                <div className="space-y-4 animate-in">
                    <div className="flex bg-slate-200 p-1 rounded-2xl gap-1">
                        <button onClick={() => setActiveTab('STOCK')} className={`flex-1 py-3 text-[10px] font-black uppercase rounded-xl ${activeTab === 'STOCK' ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}>ðŸ“¦ Stock</button>
                        <button onClick={() => setActiveTab('IMPORT')} className={`flex-1 py-3 text-[10px] font-black uppercase rounded-xl ${activeTab === 'IMPORT' ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}>ðŸ“¥ Import</button>
                    </div>

                    {activeTab === 'STOCK' ? (
                        <>
                            <div className="relative">
                                <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-300" />
                                <input type="text" placeholder="Rechercher..." className="w-full bg-white border rounded-2xl pl-10 pr-4 py-3 text-sm font-bold shadow-sm" value={search} onChange={e => setSearch(e.target.value)} />
                            </div>
                            <div className="space-y-2">
                                {products.filter(p => p.name.toLowerCase().includes(search.toLowerCase())).map(p => (
                                    <div key={p.id} className="bg-white p-4 rounded-2xl border flex justify-between items-center shadow-sm">
                                        <div><h4 className="text-sm font-black text-slate-900">{p.name}</h4><p className="text-[10px] font-bold text-slate-400">{p.sellPrice.toLocaleString()} FG â€¢ Stock: {p.stock}</p></div>
                                        <button onClick={() => deleteP(p.id)} className="text-red-300 p-2"><Trash2 className="w-4 h-4" /></button>
                                    </div>
                                ))}
                            </div>
                        </>
                    ) : (
                        <div className="py-10 text-center space-y-6">
                            <div className="bg-slate-900 p-8 rounded-[3rem] text-white">
                                <Package className="w-16 h-16 text-yellow-500 mx-auto mb-4 animate-bounce" />
                                <h3 className="text-lg font-black uppercase tracking-widest">Base CosmÃ©tique</h3>
                                <p className="text-xs opacity-50 mb-6">Ajouter instantanÃ©ment les 40 produits les plus vendus.</p>
                                <button onClick={importPre} className="w-full bg-yellow-500 text-slate-900 font-black py-4 rounded-2xl uppercase text-[10px]">Importer la liste</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const POS = () => {
            const [cart, setCart] = useState([]);
            const [products, setProducts] = useState([]);
            const [search, setSearch] = useState('');
            const [brand, setBrand] = useState(DEFAULT_BRAND_INFO);

            useEffect(() => {
                setProducts(JSON.parse(localStorage.getItem('eyn_products') || '[]'));
                const saved = localStorage.getItem('eyn_brand_info');
                if (saved) setBrand(JSON.parse(saved));
            }, []);

            const addToCart = (p) => {
                const ex = cart.find(i => i.id === p.id);
                if (ex) setCart(cart.map(i => i.id === p.id ? { ...i, quantity: i.quantity + 1 } : i));
                else setCart([...cart, { ...p, quantity: 1 }]);
                setSearch('');
            };

            const total = cart.reduce((s, i) => s + (i.sellPrice * i.quantity), 0);

            const handleShare = () => {
                let txt = `âœ¨ ${brand.name.toUpperCase()} âœ¨\nFacture :\n`;
                cart.forEach(i => txt += `- ${i.name} x${i.quantity} : ${(i.sellPrice * i.quantity).toLocaleString()} FG\n`);
                txt += `TOTAL : ${total.toLocaleString()} FG\n\nMerci de votre confiance !`;
                window.open(`https://wa.me/?text=${encodeURIComponent(txt)}`);
            };

            return (
                <div className="h-full flex flex-col space-y-4 animate-in">
                    <div className="relative">
                        <Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-300" />
                        <input type="text" placeholder="Rechercher pour vendre..." className="w-full bg-white border rounded-2xl pl-10 pr-4 py-4 text-sm font-bold shadow-sm" value={search} onChange={e => setSearch(e.target.value)} />
                        {search && (
                            <div className="absolute top-16 left-0 right-0 bg-white shadow-2xl rounded-2xl border z-50 max-h-60 overflow-y-auto divide-y">
                                {products.filter(p => p.name.toLowerCase().includes(search.toLowerCase())).map(p => (
                                    <button key={p.id} onClick={() => addToCart(p)} className="w-full p-4 text-left flex justify-between font-bold">
                                        <span>{p.name}</span> <span className="text-yellow-600">{p.sellPrice.toLocaleString()} FG</span>
                                    </button>
                                ))}
                            </div>
                        )}
                    </div>
                    <div className="flex-1 overflow-y-auto space-y-2">
                        {cart.map(item => (
                            <div key={item.id} className="bg-white p-4 rounded-2xl border flex items-center gap-4">
                                <span className="bg-slate-100 p-2 rounded-lg font-black">{item.quantity}</span>
                                <div className="flex-1 font-black text-sm">{item.name}</div>
                                <div className="font-black">{(item.sellPrice * item.quantity).toLocaleString()}</div>
                                <button onClick={() => setCart(cart.filter(i => i.id !== item.id))} className="text-red-400"><X className="w-4 h-4" /></button>
                            </div>
                        ))}
                    </div>
                    <div className="bg-slate-900 p-6 rounded-[2.5rem] shadow-2xl text-white space-y-4">
                        <div className="flex justify-between items-end border-b border-white/10 pb-4">
                            <span className="text-[10px] font-black uppercase text-white/40">Total Net</span>
                            <span className="text-3xl font-black text-yellow-500">{total.toLocaleString()} FG</span>
                        </div>
                        <button onClick={handleShare} disabled={cart.length === 0} className="w-full bg-green-500 text-white py-4 rounded-2xl font-black uppercase text-xs flex justify-center gap-2 items-center">
                            <Share2 className="w-4 h-4" /> Partager ReÃ§u WhatsApp
                        </button>
                        <button onClick={() => { alert("Vente validÃ©e !"); setCart([]); }} disabled={cart.length === 0} className="w-full bg-yellow-500 text-slate-900 py-4 rounded-2xl font-black uppercase text-xs">
                            Confirmer la Vente
                        </button>
                    </div>
                </div>
            );
        };

        const Finance = () => {
            const [brand, setBrand] = useState(DEFAULT_BRAND_INFO);
            const [activeSub, setActiveSub] = useState('STATS');

            const save = () => { localStorage.setItem('eyn_brand_info', JSON.stringify(brand)); alert("âœ… SauvegardÃ© !"); };

            return (
                <div className="space-y-6 animate-in">
                    <div className="flex bg-slate-200 p-1 rounded-2xl gap-1">
                        <button onClick={() => setActiveSub('STATS')} className={`flex-1 py-3 text-[10px] font-black uppercase rounded-xl ${activeSub === 'STATS' ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}>Stats</button>
                        <button onClick={() => setActiveSub('BRAND')} className={`flex-1 py-3 text-[10px] font-black uppercase rounded-xl ${activeSub === 'BRAND' ? 'bg-white shadow text-slate-900' : 'text-slate-500'}`}>Entreprise</button>
                    </div>

                    {activeSub === 'STATS' ? (
                        <div className="grid grid-cols-2 gap-4">
                            <div className="bg-slate-900 p-5 rounded-[2rem] text-white">
                                <p className="text-[10px] uppercase font-black opacity-40">CA Total</p>
                                <p className="text-xl font-black text-yellow-500">0 FG</p>
                            </div>
                            <div className="bg-white p-5 rounded-[2rem] border shadow-sm">
                                <p className="text-[10px] uppercase font-black text-slate-400">Profit Est.</p>
                                <p className="text-xl font-black text-slate-900">0 FG</p>
                            </div>
                        </div>
                    ) : (
                        <div className="bg-white p-6 rounded-[2.5rem] border space-y-4">
                            <input className="w-full bg-slate-50 p-4 rounded-2xl font-bold" value={brand.name} onChange={e => setBrand({...brand, name: e.target.value})} placeholder="Nom Boutique" />
                            <input className="w-full bg-slate-50 p-4 rounded-2xl font-bold" value={brand.phoneGn} onChange={e => setBrand({...brand, phoneGn: e.target.value})} placeholder="TÃ©lÃ©phone" />
                            <button onClick={save} className="w-full bg-slate-900 text-yellow-500 py-4 rounded-2xl font-black uppercase text-xs">Enregistrer</button>
                        </div>
                    )}
                </div>
            );
        };

        // --- MAIN APP ---

        const App = () => {
            const [mode, setMode] = useState('CALC');
            
            const render = () => {
                switch(mode) {
                    case 'CALC': return <CostCalculator />;
                    case 'MANAGE': return <ProductManager />;
                    case 'POS': return <POS />;
                    case 'FINANCE': return <Finance />;
                    default: return <CostCalculator />;
                }
            };

            const nav = [
                {id:'CALC', l:'CoÃ»t', i: Calculator},
                {id:'MANAGE', l:'Stock', i: Package},
                {id:'POS', l:'Vente', i: ShoppingBag},
                {id:'FINANCE', l:'Compta', i: BarChart3}
            ];

            return (
                <div className="flex flex-col h-full bg-slate-50 overflow-hidden">
                    <header className="bg-slate-900 text-white px-6 py-4 flex justify-between items-center border-b-2 border-yellow-500 z-10">
                        <div className="flex items-center gap-3">
                            <div className="bg-yellow-500 p-2 rounded-lg"><Smartphone className="w-5 h-5 text-slate-900" /></div>
                            <div>
                                <h1 className="text-xl font-black italic">EYN<span className="text-yellow-500">PRO</span></h1>
                                <p className="text-[8px] uppercase font-black opacity-40">SystÃ¨me Professionnel</p>
                            </div>
                        </div>
                        <div className="bg-slate-800 p-2 rounded-full border border-slate-700"><User className="w-5 h-5 text-slate-400" /></div>
                    </header>

                    <main className="flex-1 overflow-y-auto px-4 py-6 pb-28 hide-scrollbar">
                        {render()}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t flex justify-around items-center py-3 safe-bottom z-50 rounded-t-[2.5rem] shadow-2xl">
                        {nav.map(n => (
                            <button key={n.id} onClick={() => setMode(n.id)} className={`flex flex-col items-center gap-1 transition-all ${mode === n.id ? 'scale-110 text-slate-900' : 'text-slate-300'}`}>
                                <div className={`p-3 rounded-2xl ${mode === n.id ? 'bg-yellow-500 text-slate-900 shadow-xl rotate-[-5deg]' : ''}`}><n.i className="w-6 h-6" /></div>
                                <span className="text-[8px] font-black uppercase tracking-widest">{n.l}</span>
                            </button>
                        ))}
                    </nav>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>
